<section class="products-container">
  <!-- Barra de búsqueda -->
  <div class="search-container">
    <div class="search-input-wrapper">
      <input type="text" class="search-input" placeholder="Buscar productos..." [(ngModel)]="searchTerm"
        (input)="onSearch()" [disabled]="isLoading" />
      <button *ngIf="searchTerm" class="clear-search-btn" (click)="clearSearch()" title="Limpiar búsqueda">
        ✕
      </button>
    </div>
    <button type="button" (click)="addProduct()" class="btn btn-save w-100">
      Agregar
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Cargando productos...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <div class="error-message">
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="refreshData()">
        Reintentar
      </button>
    </div>
  </div>

  <!-- Tabla de productos -->
  <div *ngIf="!isLoading && !error" class="datatable-container">
    <table class="products-table">
      <thead>
        <tr>
          <th *ngFor="let col of displayedColumns">{{ col }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of paginatedProducts" class="product-row">
          <td class="logo-cell">
            <div class="logo-avatar">{{ getLogoInitials(product) }}</div>
          </td>
          <td class="product-name">{{ product.name }}</td>
          <td class="product-description">{{ product.description }}</td>
          <td class="release-date">{{ product.date_release | date:'dd/MM/yyyy' }}</td>
          <td class="restructure-date">{{ product.date_revision | date:'dd/MM/yyyy' }}</td>
          <td class="actions-cell">
            <button cdkOverlayOrigin #trigger="cdkOverlayOrigin" (click)="toggleDropdown(product.id)" class="
              dropdown-toggle">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-dots-vertical">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
                <path d="M12 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
                <path d="M12 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
              </svg>
            </button>
            <ng-template cdkConnectedOverlay [cdkConnectedOverlayOrigin]="trigger"
              [cdkConnectedOverlayOpen]="openDropdownId === product.id" (backdropClick)="closeDropdown()"
              [cdkConnectedOverlayPositions]="overlayPositions">
              <app-dropdown-menu (optionSelected)="onAction($event, product)"></app-dropdown-menu>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Mensaje cuando no hay datos -->
    <div *ngIf="!hasResults" class="no-data">
      <p *ngIf="searchTerm">No se encontraron productos que coincidan con "{{ searchTerm }}"</p>
      <p *ngIf="!searchTerm">No hay productos disponibles</p>
    </div>
  </div>

  <!-- Paginación -->
  <div *ngIf="!isLoading && !error && hasResults" class="pagination-container">
    <div class="results-info">
      {{ totalResults }} Resultado{{ totalResults !== 1 ? 's' : '' }}
    </div>
    <div class="pagination-controls">
      <select [(ngModel)]="resultsPerPage" (change)="onResultsPerPageChange()" class="results-per-page"
        [disabled]="isLoading">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="15">15</option>
        <option value="20">20</option>
      </select>
    </div>
  </div>
</section>
